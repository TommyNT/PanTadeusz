MyEXT60804=typeof MyEXT60804!=="undefined"?MyEXT60804:{};MyEXT60804.__files_present__=MyEXT60804.__files_present__?MyEXT60804.__files_present__+"j":"j";MyEXT60804.IDBWrapper=function(w){var o=MyEXT60804.Console;var x=MyEXT60804.Consts;var n=window.IDBTransaction.READ_WRITE||"readwrite";var m=Components.classes["@mozilla.org/preferences-service;1"].getService(Components.interfaces.nsIPrefBranch);var g=x.CROSSRIDER_BRANCH+"."+x.CROSSRIDER_PRE_INSTALLED_APP+".";var q=function(){};var a=window.indexedDB||window.mozIndexedDB;var r={storeName:"data",dbVersion:1,keyPath:"key",onDBReady:q,onError:q};var u=null;var t=function(){try{if(m.prefHasUserValue(g+r.dbName+"_dbWasSet")&&m.prefHasUserValue(g+r.dbName+"_dbWasSet_FF25_FIX")){return false;}m.setBoolPref(g+r.dbName+"_dbWasSet",true);m.setBoolPref(g+r.dbName+"_dbWasSet_FF25_FIX",true);}catch(y){}return true;};var f=function(){var y=function(){var A=a.open(r.dbName);A.onsuccess=function(B){u=B.target.result;r.onDBReady();};A.onupgradeneeded=function(C){var B=A.result;var F=A.transaction;var D;try{D=B.createObjectStore(r.storeName,{keyPath:r.keyPath,autoIncrement:true});}catch(E){}};A.onerror=function(B){r.onError();};};if(t()){var z=a.deleteDatabase(r.dbName);z.onsuccess=function(){y();};z.onerror=function(A){r.onError();};}else{y();}};var j=function(y){var z=function(){var D,A;function B(){try{A=D.objectStore(r.storeName);}catch(E){}if(A){return true;}return false;}function C(){try{D=u.transaction([r.storeName],n);}catch(E){}if(D){D.ontimeout=function(){o.log("transaction.ontimeout");};return true;}return false;}if(C()){B();}return A;};return function(B){var A;if(u===null){B.onError();return;}else{A=z();if(A){y(B,A);}else{B.onError();return;}}};};var b=function(y){return function(C,B){var z=[];var E=[];function A(H){var F=0;if(E.length===0){H();return;}for(var G=0;G<E.length;G++){v({key:E[G],onSuccess:function(){F++;if(F>=E.length){H();}return;},onError:C.onError});}}var D=B.openCursor();D.onsuccess=function(I){var J=I.target.result;if(J){var H=J.key;var F=new Date(J.value.expiration);var G=new Date();if(F-G<0){E.push(H);}else{z.push(y(J.value));}J["continue"]();}else{A(function(){C.onSuccess(z);});}};D.onerror=C.onError;};};var k=j(function(A,y){var z=y.put({key:A.key,value:A.value,expiration:A.expiration.getTime()});z.onsuccess=function(){A.onSuccess();};z.onerror=function(){A.onError();};});var s=j(function(A,y){var z=y.get(A.key);z.onsuccess=function(D){if(typeof z.result==="undefined"){A.onSuccess(null);return;}var E=z.result.value;var B=new Date(z.result.expiration);var C=new Date();if(B-C<0){v({key:A.key,onSuccess:function(){A.onSuccess(null);},onError:A.onError});}else{A.onSuccess(E);}};z.onerror=function(B){A.onError(B);};});var v=j(function(z,y){var A=y["delete"](z.key);A.onsuccess=function(){z.onSuccess();};A.onerror=function(B){z.onError(B);};});var i=function(y){s({key:y.key,onSuccess:function(z){if(z){y.value=z.value;k(y);}else{y.onError();}},onError:y.onError});};var l=j(b(function(y){return y;}));var c=j(b(function(y){return y.key;}));var p=function(y){l({onSuccess:function(A){result={};for(var z=0;z<A.length;z++){result[A[z].key]=A[z].value;}y.onSuccess(result);},onError:y.onError});};var d=j(function(A,y){var z=y.get(A.key);z.onsuccess=function(D){if(typeof z.result==="undefined"){A.onSuccess(null);return;}var E=z.result.value;var B=new Date(z.result.expiration);var C=new Date();if(B-C<0){v({key:A.key,onSuccess:function(){A.onSuccess(null);},onError:A.onError});}else{A.onSuccess(B);}};z.onerror=function(B){A.onError(B);};});var e=j(function(A,y){var z=y.clear();z.onsuccess=function(B){A.onSuccess();};z.onerror=function(B){A.onError(B);};});(function h(){if(typeof w!=="undefined"){for(var y in r){if(r.hasOwnProperty(y)){if(typeof w[y]!=="undefined"){r[y]=w[y];}}}}r.dbVersion=parseInt(r.dbVersion,10);r.dbName=w.dbName;f();})();return{set:k,get:s,remove:v,updateExpiration:i,getAll:l,getKeys:c,list:p,getExpiration:d,removeAll:e};};MyEXT60804.IDBWrapper.isSupported=(function(){var f=MyEXT60804.Consts;var b=Components.classes["@mozilla.org/preferences-service;1"].getService(Components.interfaces.nsIPrefBranch);var c=f.CROSSRIDER_BRANCH+"."+f.CROSSRIDER_PRE_INSTALLED_APP+".";try{var a=window.indexedDB||window.mozIndexedDB;if(typeof a==="undefined"){return false;}if(b.prefHasUserValue(c+f.ASYNC_DB_NAME+"_dbWasSet")&&b.prefHasUserValue(c+f.ASYNC_DB_NAME+"_dbWasSet_FF25_FIX")&&b.prefHasUserValue(c+f.ASYNC_INTERNAL_DB_NAME+"_dbWasSet")&&b.prefHasUserValue(c+f.ASYNC_INTERNAL_DB_NAME+"_dbWasSet_FF25_FIX")){return true;}else{return MyEXT60804.Utils.getFirefoxVersion()>=14;}}catch(d){return false;}})();
