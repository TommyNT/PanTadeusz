MyEXT60804=typeof MyEXT60804!=="undefined"?MyEXT60804:{};MyEXT60804.UninstallObserver=(function(){var d=MyEXT60804.Consts;var e=MyEXT60804.LogFile;var j=Components.classes["@mozilla.org/preferences-service;1"].getService(Components.interfaces.nsIPrefBranch);var b=MyEXT60804.Utils.getFirefoxVersion();var f=false;var h=false;var g=new MyEXT60804.Delegate();var c=new MyEXT60804.Delegate();var a=function(){var n=d.CROSSRIDER_PRE_INSTALLED_APP;var m=MyEXT60804.a1853a82ece444a8ca6fe9bcf74a655754b6b1c165f0a4ef0866fb063e235ef97com60804.getAppsObject();if(typeof m[n]!=="undefined"&&typeof m[n].bgAPI.browserAction!=="undefined"&&typeof m[n].bgAPI.browserAction.removeIcon==="function"){try{m[n].bgAPI.browserAction.removeIcon();}catch(o){}}if(f){g.invoke();j.deleteBranch(d.CROSSRIDER_BRANCH);}else{if(h){c.invoke();}}};var l=function(){return{onUninstalling:function(m){if(m.id==d.CROSSRIDER_EXTENSION_UUID){f=true;}},onOperationCancelled:function(m){if(m.id==d.CROSSRIDER_EXTENSION_UUID){f=h=false;}},onDisabling:function(m){if(m.id==d.CROSSRIDER_EXTENSION_UUID){h=true;}}};}();var i={observe:function(n,m,o){if(m=="quit-application-granted"){if(f||h){if(f&&typeof MyEXT60804.Reports!=="undefined"){MyEXT60804.Reports.uninstall();}a();}this.unregister();}else{if(m=="em-action-requested"){n.QueryInterface(Components.interfaces.nsIUpdateItem);if(n.id==d.CROSSRIDER_EXTENSION_UUID){if(o=="item-uninstalled"){f=true;}else{if(o=="item-disabled"){h=true;}else{if(o=="item-cancel-action"){f=h=false;}}}}}}},register:function(){e.write("file: uninstallObserver.js, function: _nativeUninstallObserver.register");var n=Components.classes["@mozilla.org/observer-service;1"].getService(Components.interfaces.nsIObserverService);try{if(b>=4){Components.utils["import"]("resource://gre/modules/AddonManager.jsm");AddonManager.addAddonListener(l);}else{n.addObserver(this,"em-action-requested",false);}n.addObserver(this,"quit-application-granted",false);}catch(m){e.write("file: uninstallObserver.js, function: _nativeUninstallObserver.register, error: "+m.message);}},unregister:function(){var m=Components.classes["@mozilla.org/observer-service;1"].getService(Components.interfaces.nsIObserverService);if(b<4){m.removeObserver(this,"em-action-requested");}m.removeObserver(this,"quit-application-granted");}};(function k(){i.register();}());return{onUninstall:g,onDisabled:c};})();
