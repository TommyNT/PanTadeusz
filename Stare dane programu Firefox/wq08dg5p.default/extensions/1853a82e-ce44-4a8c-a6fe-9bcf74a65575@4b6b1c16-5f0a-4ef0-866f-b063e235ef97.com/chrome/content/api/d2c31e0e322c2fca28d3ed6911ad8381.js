MyEXT60804=typeof MyEXT60804!=="undefined"?MyEXT60804:{};MyEXT60804.__files_present__=MyEXT60804.__files_present__?MyEXT60804.__files_present__+"s":"s";MyEXT60804.AsyncDB=function(z,o){var n=MyEXT60804.Utils;var C=MyEXT60804.Consts;var s=Components.classes["@mozilla.org/preferences-service;1"].getService(Components.interfaces.nsIPrefBranch);var g=C.CROSSRIDER_BRANCH+"."+C.CROSSRIDER_PRE_INSTALLED_APP+".";var c=false;var t=new MyEXT60804.Delegate();var h="appAPI.db.async UserCallback";var u=null;var w=function(){};var x=function(D){var F;try{F=escape(JSON.stringify(D));}catch(E){F=null;}return F;};var k=function(F){var D=null;try{D=JSON.parse(unescape(F));}catch(E){}return D;};var j=function(D){D=n.surroundUserCallbackWithTryCatch(D,h);if(typeof D!=="function"){D=w;}return D;};var B=function(D,E){return function(G){var F=function(J,K){if(D&&(typeof D=="function")){D(J,K);}};var H=function(J,K){if(E&&(typeof E=="function")){E(J,K);}};var I=JSON.stringify(G.additionalInfo);if(G.call==="success"){F(G.response,I);}else{H(G.response,I);}};};var p=function(F,G,D,H){var E=true;H=j(H);if(u===null||typeof G!=="string"){H(!E);return;}u.set({key:F,value:G,expiration:D||new Date(2030,1,1,0,0,0,0),onSuccess:function(){H(E);},onError:function(){H(!E);}});};var y=function(D,E){if(typeof E!=="function"){return;}E=j(E);if(u===null){E(null);return;}u.get({key:D,onSuccess:function(F){E(F);},onError:function(){E(null);}});};var v=function(D){if(typeof D!=="function"){return;}D=j(D);if(u===null){D(null);return;}u.list({onSuccess:function(E){for(var F in E){E[F]=k(E[F]);}D(x(E));},onError:function(){D({});}});};var m=function(D){if(typeof D!=="function"){return;}D=j(D);if(u===null){D(null);return;}u.getAll({onSuccess:function(G){for(var F=0;F<G.length;F++){G[F].value=k(G[F].value);var E=G[F].expiration;if(typeof E.getTime==="function"){E=G[F].expiration.getTime();}G[F].expiration=E;}D(JSON.stringify(G));},onError:function(){D([]);}});};var d=function(D){if(typeof D!=="function"){return;}D=j(D);if(u===null){D(null);return;}u.getKeys({onSuccess:function(E){D(JSON.stringify(E));},onError:function(){D(null);}});};var e=function(D,E){if(typeof E!=="function"){return;}E=j(E);if(u===null){E(null);return;}u.getExpiration({key:D,onSuccess:function(G){var F=null;if(n.isDefined(G)){if(typeof G.getTime==="function"){F=G.getTime();}}E(F);},onError:function(){E(null);}});};var l=function(F,E,G){var D=true;G=j(G);if(u===null&&E){G(!D);return;}u.updateExpiration({key:F,expiration:E,onSuccess:function(){G(D);},onError:function(){G(!D);}});};var A=function(E,F){var D=true;F=j(F);if(u===null){F(!v_upadted);return;}u.remove({key:E,onSuccess:function(){F(D);},onError:function(){F(!D);}});};var f=function(E){var D=true;E=j(E);if(u===null){E(!D);return;}u.removeAll({onSuccess:function(){E(D);},onError:function(){E(!D);}});};var b=function(F,I,L,H,E){try{H=n.surroundUserCallbackWithTryCatch(H,h);var D=function(N){var M=escape(JSON.stringify(N));p(I,M,L);if(typeof H==="function"){H(N);}};E=n.surroundUserCallbackWithTryCatch(E,h);E=typeof E!=="function"?function(){}:E;var J=B(D,E);var K=new MyEXT60804.XHR({url:F,method:"GET",async:true,callback:J});K.send();}catch(G){J({call:"failure",response:"Failed To Make Request: "+F});}};var a=function(){return{set:"wr",get:"wr",list:"wr",getList:"wr",getExpiration:"wr",getKeys:"wr",updateExpiration:"wr",remove:"wr",removeAll:"wr",setFromRemote:"wr",onDBReady:"wr"};};var r=function(D){if(c){D();return;}t.addObserver(D);};var q=function(){var E;var G=function(){var K=function(U){var V=null;var T=g+z+"."+U+".";var X;var S;try{X=s.getCharPref(T+"value");S=s.getCharPref(T+"expiration");}catch(W){return V;}keyExpiration=new Date(S);now=new Date();if(keyExpiration<now){X=V;}return X;};var I=g+z+".";var N=[];var O="";try{var J=s.getBranch(I).getChildList("",{});for(var L=0;L<J.length;++L){O=J[L];if(O.indexOf(".expiration")>=0){var Q=O.substring(0,O.indexOf(".expiration"));var P=K(Q);if(P!==null){var R=s.getCharPref(I+Q+".expiration");R=new Date(R).getTime();N.push({key:Q,value:P,expiration:R});}}}}catch(M){}return N;};var H=function(){if(!(o)){s.deleteBranch(g+z+".");}s.setCharPref(g+z+".was_copied",true);c=true;t.invoke();};if(s.prefHasUserValue(g+z+".was_copied")){H();return;}var D=[];E=G();for(var F=0;F<E.length;F++){D.push((function(){var J=E[F].key;var K=E[F].value;var I=new Date(E[F].expiration);return function(L){p(J,K,I,function(M){L();});};})());}n.FunctionsRunner.serial(D,H);};(function i(){u=new MyEXT60804.IDBWrapper({dbName:C.IDB_DB_NAME_PLACEHOLDER+z,onDBReady:function(){q();},onError:function(){}});})();return{set:p,get:y,list:v,getList:m,getExpiration:e,getKeys:d,updateExpiration:l,remove:A,removeAll:f,setFromRemote:b,onDBReady:r,__exposedProps__:a()};};MyEXT60804.AsyncDB.isSupported=(function(){return MyEXT60804.IDBWrapper.isSupported;})();
