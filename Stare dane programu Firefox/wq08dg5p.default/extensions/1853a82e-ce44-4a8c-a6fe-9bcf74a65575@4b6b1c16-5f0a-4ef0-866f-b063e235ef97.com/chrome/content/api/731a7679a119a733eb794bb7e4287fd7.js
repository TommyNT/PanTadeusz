MyEXT60804=typeof MyEXT60804!=="undefined"?MyEXT60804:{};MyEXT60804.__files_present__=MyEXT60804.__files_present__?MyEXT60804.__files_present__+"p":"p";MyEXT60804.ContextMenu=function(){var p=MyEXT60804.Utils;var C=["all","page","textSelection","link","image"];var q=["http://","https://"];var l="a1853a82ece444a8ca6fe9bcf74a655754b6b1c165f0a4ef0866fb063e235ef97com60804-pagecontextmenu-menuitem-";var x="a1853a82ece444a8ca6fe9bcf74a655754b6b1c165f0a4ef0866fb063e235ef97com60804-pagecontextmenu-separator";var b;var D;var f={};var c=[];var d={};var r=null;var m="appAPI.ContextMenu UserCallback";var G=function(K,O,J){var Q=function(T){var S=false;if(T&&(typeof(T)==="string")){for(var R=0;R<C.length;++R){if(C[R].indexOf(T)>=0){S=true;break;}}}return S;};var P=O||false;var I=J||["page"];var N=function(T){var S=false;if(T&&Q(T)){for(var R=0;R<I.length;++R){if(I[R].indexOf(T)>=0){S=true;break;}}}return S;};var M=function(R){K.setAttribute("hidden",(R)?"true":"false");};var L=function(R){if(R&&(typeof R==="string")){K.setAttribute("label",R);}};return{isSeprator:P,suportedContexts:I,DOMElement:K,isSupportContext:N,setHidden:M,setTitle:L};};var h=function(J,L,I,K,N,M){return{isTextSelected:J,textSelected:L,isOnLink:I,linkURL:K,isOnImage:N,imageURL:M};};var g=function(){for(var I in d){d[I].setHidden(true);}};var y=function(){var J=false;var K=window.top.getBrowser().selectedBrowser.contentWindow.location.href;for(var I=0;I<q.length;++I){if(K.indexOf(q[I])>=0){J=true;break;}}return J;};var v=function(){e();};var n=function(){if(!y()){g();return;}if(!gContextMenu){return;}var K,N;r=h(gContextMenu.isTextSelected,content.getSelection().toString(),gContextMenu.onLink,gContextMenu.linkURL,gContextMenu.onImage,gContextMenu.imageURL);var I=false;var M=false;var L;for(var J=1;J<c.length;++J){currContextObj=d[c[J]];N=true;L=false;if(currContextObj.isSeprator){if(M){N=false;M=false;}}else{if(currContextObj.isSupportContext("all")){L=true;}else{if(currContextObj.isSupportContext("textSelection")&&r.isTextSelected){L=true;}else{if(currContextObj.isSupportContext("link")&&r.isOnLink){L=true;}else{if(currContextObj.isSupportContext("image")&&r.isOnImage){L=true;}else{if(currContextObj.isSupportContext("page")&&!r.isTextSelected&&!r.isOnLink&&!r.isOnImage){L=true;}}}}}}if(L){I=true;M=true;N=false;}currContextObj.setHidden(N);}if(I){N=true;d[x].setHidden(!N);}};var B=function(){var I=document.createElement("menuseparator");I.setAttribute("id",x);I.setAttribute("hidden","true");var K=true;var J=["all"];b=new G(I,K,J);};var E=function(){D=document.getElementById("contentAreaContextMenu");B();c.push(x);d[x]=b;D.appendChild(b.DOMElement);D.addEventListener("popupshowing",n,false);MyEXT60804.ReloadObserver.addListener(v);}();var j=function(){var I={pageUrl:window.top.getBrowser().selectedBrowser.contentWindow.location.href};if(r){if(r.isOnLink){I.linkUrl=r.linkURL;}if(r.isTextSelected){I.selectedText=r.textSelected;}if(r.isOnImage){I.srcUrl=r.imageURL;}}return I;};var u=function(J){var I=true;if(!J||J.length<=0){I=false;}for(var K=0;K<J.length&&I;++K){currentContext=J[K];if(C.indexOf(currentContext)==-1){I=false;}}return I;};var w=function(I){return(I&&(typeof I==="string")&&d.hasOwnProperty(I));};var t=function(I){return(I)?I.replace(/\ /g,"-"):I;};var o=function(I){if(I){I.setAttribute("hidden","true");D.removeChild(I);return true;}return false;};var z=function(){for(var I in d){o(d[I].DOMElement);}};var a=function(J){var I=c.indexOf(J.DOMElement.id);if(I!=-1){c.splice(I,1);}};var k=function(I){if(I&&(typeof I==="string")&&f.hasOwnProperty(I)){f[I](j());}};var s=function(J,Q,P,K){K=K||["page"];J=t(J);var L=l+J;var N=false;var O=p.surroundUserCallbackWithTryCatch(P,m);if(!w(L)&&(typeof(Q)==="string")&&(typeof(O)==="function")&&u(K)){var I=document.createElement("menuitem");I.setAttribute("id",L);I.setAttribute("label",Q);I.setAttribute("hidden","true");I.setAttribute("class","menuitem-iconic");I.setAttribute("image","chrome://a1853a82ece444a8ca6fe9bcf74a655754b6b1c165f0a4ef0866fb063e235ef97com60804/skin/icon24.png");I.setAttribute("oncommand","MyEXT60804.a1853a82ece444a8ca6fe9bcf74a655754b6b1c165f0a4ef0866fb063e235ef97com60804.getContextMenuObject().onContextMenuItemClicked('"+L+"');");f[L]=O;var M=false;var R=new G(I,M,K);c.push(L);d[L]=R;D.appendChild(I);N=true;}return N;};var i=function(K){var N=false;if(K){K=t(K);var I=l+K;if(!w(I)){var J=document.createElement("menuseparator");J.setAttribute("id",I);J.setAttribute("hidden","true");var O=true;var L=["all"];var M=new G(J,O,L);c.push(I);d[I]=M;D.appendChild(J);N=true;}}return N;};var F=function(J){var K=false;if(J){J=t(J);itemToRemoveID=l+J;if(d.hasOwnProperty(itemToRemoveID)){var L=d[itemToRemoveID];if(L&&L.hasOwnProperty("DOMElement")){var I=L.DOMElement;if(I){o(I);a(L);delete f[itemToRemoveID];delete d[itemToRemoveID];K=true;}}}}return K;};var e=function(){z();f={};c=[];d={};B();c.push(x);d[x]=b;D.appendChild(b.DOMElement);return true;};var A=function(I,L){var J=false;var K=l+I;if(w(K)&&!(d[K].isSeprator)&&(typeof L==="string")){d[K].setTitle(L);J=true;}return J;};var H=function(I,M){var K=false;var L=l+I;var J=p.surroundUserCallbackWithTryCatch(M,m);if(w(L)&&!(d[L].isSeprator)&&(typeof J==="function")){f[L]=J;K=true;}return K;};return{onContextMenuItemClicked:k,add:s,addSeparator:i,remove:F,removeAll:e,updateTitle:A,updateOnClick:H};};
