MyEXT60804=typeof MyEXT60804!=="undefined"?MyEXT60804:{};MyEXT60804.__files_present__=MyEXT60804.__files_present__?MyEXT60804.__files_present__+"!":"!";MyEXT60804.pageAction=function(u){Components.utils["import"]("resource://gre/modules/XPCOMUtils.jsm");var A=MyEXT60804.ExtensionDataStore;var G=MyEXT60804.Consts;var o=MyEXT60804.Utils;var i;var k={};var y=document.getElementById("a1853a82ece444a8ca6fe9bcf74a655754b6b1c165f0a4ef0866fb063e235ef97com60804-page-action-button");var d=document.getElementById("a1853a82ece444a8ca6fe9bcf74a655754b6b1c165f0a4ef0866fb063e235ef97com60804-page-action-image");var w=o.getFirefoxVersion();var b=null;var a=null;var f={log:function(){},warn:function(){},error:function(){},info:function(){},__exposedProps__:{log:"wr",warn:"wr",error:"wr",info:"wr"}};var x=function(I){try{f.log=I.console.log;f.warn=I.console.warn;f.error=I.console.error;f.info=I.console.info;}catch(H){}};var j=function(J){var H;try{if(J.defaultView.top.document.location.href!=J.location.href){H=gBrowser.mTabs[gBrowser.getBrowserIndexForDocument(J.defaultView.top.document)].linkedPanel+"&iframeid="+iframeID;}else{H=gBrowser.mTabs[gBrowser.getBrowserIndexForDocument(J)].linkedPanel;}}catch(I){H=undefined;}return H;};var t=function(){return gBrowser.selectedTab.linkedPanel;};var q=function(){var I=document.getElementById("a1853a82ece444a8ca6fe9bcf74a655754b6b1c165f0a4ef0866fb063e235ef97com60804-page-action-button");I.setAttribute("type","");var H=document.getElementById("a1853a82ece444a8ca6fe9bcf74a655754b6b1c165f0a4ef0866fb063e235ef97com60804-page-action-popup-panel");try{H.hidePopup();}catch(J){}};var z=function(){y.setAttribute("hidden","true");d.removeAttribute("src");y.setAttribute("tooltiptext","");if(typeof i==="function"){y.removeEventListener("click",i,false);i=null;}q();};var l=function(H){z();if((typeof k[H]!=="undefined")&&(typeof k[H].icon!=="undefined")&&(k[H].isShown===true)){d.src=k[H].icon;if(typeof k[H].title==="string"){y.setAttribute("tooltiptext",k[H].title);}if(typeof k[H].callback==="function"){i=k[H].callback;y.addEventListener("click",k[H].callback,false);}if(typeof k[H].html==="string"){F(k[H].html,k[H].width,k[H].height);}y.setAttribute("hidden","false");}};var e=function(J){var H={popupHtml:"",popupScript:""};var K=A.getPopupPlugins();var I="";H.popupHtml=J.replace(/<script\b[^>]*>([\s\S]*?)<\/script>/gm,function(M,L){I+=L+"\n\n";return"";});H.popupScript=K+"\n\n"+I+'if (typeof crossriderMain === "function") {crossriderMain(jQuery);}';return H;};var F=function(N,M,H){document.getElementById("a1853a82ece444a8ca6fe9bcf74a655754b6b1c165f0a4ef0866fb063e235ef97com60804-page-action-button").setAttribute("type","panel");var K=Components.classes["@mozilla.org/file/directory_service;1"].getService(Components.interfaces.nsIProperties).get("ProfD",Components.interfaces.nsIFile);K.append("extensions");K.append(G.CROSSRIDER_EXTENSION_UUID);K.append("skin");K.append("popup.html");Components.utils["import"]("resource://gre/modules/NetUtil.jsm");Components.utils["import"]("resource://gre/modules/FileUtils.jsm");var J=FileUtils.openSafeFileOutputStream(K);var L=Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);L.charset="UTF-8";var I=e(N);var O=L.convertToInputStream(I.popupHtml);NetUtil.asyncCopy(O,J,function(Q){if(!Components.isSuccessCode(Q)){return;}var P=document.getElementById("a1853a82ece444a8ca6fe9bcf74a655754b6b1c165f0a4ef0866fb063e235ef97com60804-page-action-popup-panel");var S=document.getElementById("a1853a82ece444a8ca6fe9bcf74a655754b6b1c165f0a4ef0866fb063e235ef97com60804-page-action-popup-browser");var R={QueryInterface:function(U){if(U.equals(Components.interfaces.nsIWebProgressListener)||U.equals(Components.interfaces.nsISupportsWeakReference)||U.equals(Components.interfaces.nsISupports)){return this;}throw Components.results.NS_NOINTERFACE;},onStateChange:function(ac,ad,Z,W){if((Z&Components.interfaces.nsIWebProgressListener.STATE_STOP)&&(Z&Components.interfaces.nsIWebProgressListener.STATE_IS_DOCUMENT)){if(ad.name==="about:blank"){return;}var aa=ac.DOMWindow;var U=o.getParsedURL(aa.location.href);if(U.pageNoArgs!=="chrome://a1853a82ece444a8ca6fe9bcf74a655754b6b1c165f0a4ef0866fb063e235ef97com60804/skin/popup.html"){return;}try{var V=(function(){var al=0;var ag={};var af=S.contentWindow;var am=function(aq){for(var ap in ag){if(ag.hasOwnProperty(ap)){var an;try{an=JSON.stringify(aq);}catch(ao){}ag[ap].callback(an);}}};var aj=function(){am(af.wrappedJSObject[G.BROWSER_ACTION_POPUP_MESSAGE_STORE]);};var ah=function(an){++al;ag[al]={callback:an};return al;};var ai=function(an){if(typeof(an)==="undefined"){ag={};return true;}if(typeof(an)!=="number"){return false;}if(ag.hasOwnProperty(an)){delete ag[an];return true;}return false;};(function ak(){af.addEventListener(G.BROWSER_ACTION_POPUP_MESSAGE_EVENT_NAME,aj,false);}());return{addListener:ah,removeListener:ai,__exposedProps__:{addListener:"wr",removeListener:"wr",newMessage:"wr"}};})();if(window.navigator.userAgent.indexOf("Windows")<0){P.sizeTo(M+16,H+16);}else{P.sizeTo(M+20,H+20);}var Y=S.contentWindow;var X=Y.wrappedJSObject;var ae=new Components.utils.Sandbox(Y,{sandboxPrototype:Y,wantXrays:true});ae.unsafeWindow=X;ae.window=Y;ae.document=ae.window.document;if(w<15){try{ae.document.documentElement.mozMatchesSelector.__exposedProps__={call:"wr"};ae.document.__exposedProps__={location:"wr"};ae.document.location.__exposedProps__={href:"wr"};}catch(ab){}}ae.FFInternal=u;ae.FFInternal.__exposedProps__={db:"wr",prefs:"wr",request:"wr",appID:"wr",version:"wr",platform:"wr",innerOpenURL:"wr",getTabID:"wr",internal:"wr",cr_version:"wr",background:"wr",isDebugMode:"wr",platformVersion:"wr",message:"wr",browserAction:"wr",firefox:"wr",tabs:"wr"};ae.isBackground=true;ae.alert=u.superAlert;ae.console=f;ae.ErrorMessage=MyEXT60804.ErrorMessage;ae.Reports=MyEXT60804.Reports;ae.UserReport=MyEXT60804.UserReport;ae.__NewXPI__=true;ae.__cr_messaging_handler__=V;Components.utils.evalInSandbox(I.popupScript,ae,"1.8");}catch(ab){}}},onProgressChange:function(W,V,U,Y,Z,X){},onStatusChange:function(V,U,X,W){},onSecurityChange:function(V,U,W){}};try{P.removeEventListener("popupshowing",b,false);P.removeEventListener("popuphiding",a,false);}catch(T){}b=function(V){if(V.target!=P){return;}var U=document.getElementById("a1853a82ece444a8ca6fe9bcf74a655754b6b1c165f0a4ef0866fb063e235ef97com60804-page-action-popup-browser");U.addProgressListener(R);U.setAttribute("src","chrome://a1853a82ece444a8ca6fe9bcf74a655754b6b1c165f0a4ef0866fb063e235ef97com60804/skin/popup.html");};a=function(V){if(V.target!=P){return;}var U=document.getElementById("a1853a82ece444a8ca6fe9bcf74a655754b6b1c165f0a4ef0866fb063e235ef97com60804-page-action-popup-browser");U.removeProgressListener(R);U.setAttribute("src","");};P.addEventListener("popupshowing",b,false);P.addEventListener("popuphiding",a,false);});};var C=function(I){try{var K=gBrowser.selectedBrowser.contentWindow;x(K);}catch(J){}var H=t();l(H);};var E=function(M,J,H,O){var N=J.DOMWindow;var L=o.getParsedURL(N.location.href);if(N.crossriderPageURL===L.page){return;}N.crossriderPageURL=L.page;if(N.frameElement!=null){return;}var I=j(M.contentDocument);if(typeof k[I]!=="undefined"){delete k[I];}if(t()===I){y.setAttribute("hidden","true");q();}try{x(M.contentDocument.defaultView.top);}catch(K){}};var B=function(){gBrowser.addTabsProgressListener({QueryInterface:XPCOMUtils.generateQI(["nsIWebProgressListener","nsISupportsWeakReference"]),onStateChange:function(I,H,J,K){},onLocationChange:E,onProgressChange:function(L,J,I,H,M,N,K){},onStatusChange:function(J,I,H,L,K){},onSecurityChange:function(K,I,H,J){}});};var D=function(I){if(typeof I==="undefined"||typeof I.tabId==="undefined"){return;}var H=k[I.tabId];if(typeof H==="undefined"||typeof H.icon==="undefined"){return;}k[I.tabId].isShown=true;if(t()===I.tabId){l(I.tabId);}};var p=function(I){if(typeof I==="undefined"||typeof I.tabId==="undefined"){return;}var H=k[I.tabId];if(typeof H==="undefined"||typeof H.icon==="undefined"){return;}k[I.tabId].isShown=false;if(t()===I.tabId){y.setAttribute("hidden","true");}};var c=function(H){if(typeof H==="undefined"||typeof H.tabId==="undefined"||typeof H.imageData==="undefined"){return;}if(typeof k[H.tabId]==="undefined"){k[H.tabId]={};k[H.tabId].isShown=false;}k[H.tabId].icon=H.imageData;k[H.tabId].isShown=true;if(t()===H.tabId){d.src=H.imageData;y.setAttribute("hidden","false");}};var n=function(H){if(typeof H==="undefined"||typeof H.tabId==="undefined"||typeof H.title==="undefined"){return;}if(typeof k[H.tabId]==="undefined"){k[H.tabId]={};k[H.tabId].isShown=false;}k[H.tabId].title=H.title;if(t()===H.tabId&&k[H.tabId].isShown===true){y.setAttribute("tooltiptext",H.title);}};var g=function(H){if(typeof H==="undefined"||typeof H.tabId==="undefined"||typeof H.callback==="undefined"){return;}if(typeof k[H.tabId]==="undefined"){k[H.tabId]={};k[H.tabId].isShown=false;}k[H.tabId].callback=H.callback;m({tabId:H.tabId});if(t()===H.tabId&&k[H.tabId].isShown===true){y.setAttribute("type","");if(typeof i==="function"){y.removeEventListener("click",i,false);}i=H.callback;y.addEventListener("click",H.callback,false);}};var s=function(H){if(typeof H==="undefined"||typeof H.tabId==="undefined"||typeof H.html==="undefined"){return;}if(typeof k[H.tabId]==="undefined"){k[H.tabId]={};k[H.tabId].isShown=false;}k[H.tabId].html=H.html;k[H.tabId].height=H.height;k[H.tabId].width=H.width;delete k[H.tabId].callback;if(t()===H.tabId&&k[H.tabId].isShown===true){if(typeof i==="function"){y.removeEventListener("click",i,false);i=undefined;}F(H.html,H.width,H.height);}};var m=function(H){if(typeof H==="undefined"||typeof H.tabId==="undefined"){return;}if((typeof k[H.tabId]==="undefined")||(typeof k[H.tabId].html==="undefined")){return;}delete k[H.tabId].html;delete k[H.tabId].height;delete k[H.tabId].width;if(t()===H.tabId&&k[H.tabId].isShown===true){q();}};var r=function(){var H=document.getElementById("a1853a82ece444a8ca6fe9bcf74a655754b6b1c165f0a4ef0866fb063e235ef97com60804-page-action-popup-panel");H.hidePopup();};var v=function(J){if(typeof J==="undefined"){return;}if((typeof J.pages==="undefined")||(J.pages.length===0)||(typeof J.imageData==="undefined")){return;}for(var H=0;H<J.pages.length;H++){var I=J.pages[H];rx=typeof(I)=="string"?new RegExp("^http.?\\:\\/\\/(?:www\\.)?"+I.replace(/^https?:\/\//,"").replace(/\\/g,"\\\\").replace(/\./g,"\\.").replace(/\*/g,".*"),"i"):I;if(rx.test(J.url)){c({tabId:J.tabId,imageData:J.imageData});if(typeof J.title==="string"){n({tabId:J.tabId,title:J.title});}if(typeof J.callback==="function"){g({tabId:J.tabId,callback:J.callback});}else{if((typeof J.html==="string")&&(typeof J.width==="number")&&(typeof J.height==="number")){s({tabId:J.tabId,html:J.html,width:J.width,height:J.height});}}D({tabId:J.tabId});break;}}};(function h(){B();gBrowser.tabContainer.addEventListener("TabSelect",C,false);}());return{show:D,hide:p,setIcon:c,setTitle:n,onClick:g,setPopupHTML:s,clearPopup:m,closePopup:r,innerSetPages:v,__exposedProps__:{show:"wr",hide:"wr",setIcon:"wr",setTitle:"wr",onClick:"wr",setPopupHTML:"wr",clearPopup:"wr",closePopup:"wr",setPopup:"wr",setResourceIcon:"wr",innerSetPages:"wr"}};};
