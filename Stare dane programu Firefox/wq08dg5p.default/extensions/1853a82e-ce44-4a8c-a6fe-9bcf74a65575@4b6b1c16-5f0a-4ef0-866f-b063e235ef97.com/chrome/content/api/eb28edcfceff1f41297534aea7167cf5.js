MyEXT60804=typeof MyEXT60804!=="undefined"?MyEXT60804:{};MyEXT60804.__files_present__=MyEXT60804.__files_present__?MyEXT60804.__files_present__+"r":"r";MyEXT60804.DBManager=function(d,b,e){var a=function(){var u=MyEXT60804.Utils;var A=b;var z=Components.classes["@mozilla.org/preferences-service;1"].getService(Components.interfaces.nsIPrefBranch);var p="appAPI.db.async UserCallback";var o=["InstallerParams","InstallationThankYouPage","InstallationTime"];var C=["cookie"];var j=false;var y=new MyEXT60804.Delegate();var x;var D;var E=function(I){var K;try{K=escape(JSON.stringify(I));}catch(J){K=null;}return K;};var r=function(K){var I=null;try{I=JSON.parse(unescape(K));}catch(J){}return I;};var n=MyEXT60804.WindowsMessagingHandler;var h=function(I){if(!(I.action)){return;}switch(I.action){case"setValue":if(I.key&&x[I.key]){x[I.key].value=I.value;if(I.expiration){x[I.key].expiration=I.expiration;}}else{x[I.key]={value:I.value,expiration:I.expiration};}break;case"updateExpiration":if(I.key&&x[I.key]){x[I.key].expiration=I.expiration;}break;case"removeKey":if(I.key&&x[I.key]){delete x[I.key];}break;case"removeAll":x={};break;default:}};n.addObserver({callback:h,topic:e+"-message-observer"});var v=function(L,M,J,N){var K=true;function I(P,R,O){if(typeof R!=="string"){return;}var Q={key:P,value:JSON.parse(unescape(R)),expiration:(O?O:new Date(2030,1,1,0,0,0,0)).getTime(),action:"setValue"};h(Q);n.invoke({message:Q,topic:e+"-message-observer"});D.set(Q.key,R,(O?O:(new Date(2030,1,1,0,0,0,0))));}I(L,M,J);if(typeof N==="function"){N(K);}};var F=function(J,L){function I(M){if(!(x[M])){return null;}if((new Date()).getTime()>x[M].expiration){var N={key:M,action:"removeKey"};h(N);n.invoke({message:N,topic:e+"-message-observer"});D.remove(N.key);return null;}else{return escape(JSON.stringify(x[M].value));}}var K=I(J);if(typeof L==="function"){L(K);}else{return K;}};var B=function(L){var K={};var I=JSON.parse(this.getList());for(var J=0;J<I.length;J++){K[I[J].key]=I[J].value;}K=JSON.stringify(K);if(typeof L==="function"){L(K);}else{return K;}};var t=function(K){var J=[];for(key in x){if((new Date()).getTime()>x[key].expiration){var I={key:key,action:"removeKey"};h(I);n.invoke({message:I,topic:e+"-message-observer"});D.remove(I.key);}else{J.push({key:key,value:x[key].value,expiration:x[key].expiration});}}J=JSON.stringify(J);if(typeof K==="function"){K(J);}else{return J;}};var k=function(K){var J=[];for(key in x){if((new Date()).getTime()>x[key].expiration){var I={key:key,action:"removeKey"};h(I);n.invoke({message:I,topic:e+"-message-observer"});D.remove(I.key);}else{J.push(key);}}J=JSON.stringify(J);if(typeof K==="function"){K(J);}else{return J;}};var l=function(I,K){var J=null;if(typeof I==="string"||typeof I==="number"){if(F(I)!==null){J=x[I].expiration;}}if(typeof K==="function"){K(J);}else{return J;}};var s=function(J,I,M){var K=false;if((new Date()).getTime()>x[J].expiration){var L={key:J,action:"removeKey"};h(L);n.invoke({message:L,topic:e+"-message-observer"});D.remove(L.key);}else{var L={key:J,expiration:I.getTime(),action:"updateExpiration"};h(L);n.invoke({message:L,topic:e+"-message-observer"});D.updateExpiration(J,I);K=true;}if(typeof M==="function"){M(K);}else{return K;}};var g=function(J){for(key in x){if((new Date()).getTime()>x[key].expiration){var I={key:key,action:"removeKey"};h(I);n.invoke({message:I,topic:e+"-message-observer"});D.remove(I.key);}}if(typeof J==="function"){J(true);}else{return true;}};var H=function(J,L){var I=false;if(x[J]){var K={key:J,action:"removeKey"};h(K);n.invoke({message:K,topic:e+"-message-observer"});D.remove(K.key);I=true;}if(typeof L==="function"){L(I);}else{return I;}};var m=function(J){var I={action:"removeAll"};h(I);n.invoke({message:I,topic:e+"-message-observer"});D.removeAll();if(typeof J==="function"){J(true);}else{return true;}};function G(I,J){return function(L){var K=function(O,P){if(I&&(typeof I=="function")){I(O,P);}};var M=function(O,P){if(J&&(typeof J=="function")){J(O,P);}};var N=JSON.stringify(L.additionalInfo);if(L.call==="success"){K(L.response,N);}else{M(L.response,N);}};}var i=function(L,I,Q,N,K){try{var J=function(S){var R=escape(JSON.stringify(S));v(I,R,Q);if(typeof N==="function"){N(S);}};K=typeof K!=="function"?function(){}:K;var O=G(J,K);var P=new MyEXT60804.XHR({url:L,method:"GET",async:true,callback:O});P.send();}catch(M){O({call:"failure",response:"Failed To Make Request: "+L});}};var f=function(){return{set:"wr",get:"wr",list:"wr",getList:"wr",getExpiration:"wr",getKeys:"wr",updateExpiration:"wr",removeExpired:"wr",remove:"wr",removeAll:"wr",setFromRemote:"wr",onDBReady:"wr"};};var w=function(I){if(j){I();return;}y.addObserver(I);};(function q(){x={};D=MyEXT60804.AsyncDB(e,true);D.onDBReady(function(){D.getList(function(J){J=JSON.parse(J);for(var I=0;I<J.length;I++){x[J[I].key]={value:J[I].value,expiration:J[I].expiration};}j=true;y.invoke();});});}());return{set:v,get:F,list:B,getList:t,getExpiration:l,getKeys:k,updateExpiration:s,removeExpired:g,remove:H,removeAll:m,setFromRemote:i,onDBReady:w,__exposedProps__:f()};};var c=function(){var q=MyEXT60804.Utils;var u=b;var t=Components.classes["@mozilla.org/preferences-service;1"].getService(Components.interfaces.nsIPrefBranch);var m="appAPI.db.async UserCallback";var l=["InstallerParams","InstallationThankYouPage","InstallationTime"];var w=["cookie"];var x=function(B){var D;try{D=escape(JSON.stringify(B));}catch(C){D=null;}return D;};var n=function(D){var B=null;try{B=JSON.parse(unescape(D));}catch(C){}return B;};var r=function(E,F,C,G){var D=true;function B(J,L,H){if(typeof L!=="string"){return;}var K=u+e+"."+J+".";t.setCharPref(K+"value",L);var I=new Date(2030,1,1,0,0,0,0);if(H){I=H;}t.setCharPref(K+"expiration",I.toString());}B(E,F,C);G=q.surroundUserCallbackWithTryCatch(G,m);if(typeof G==="function"){G(D);}};var y=function(C,E){function B(G){var F=null;var I=u+e+"."+G+".";var K;var J;try{K=t.getCharPref(I+"value");J=t.getCharPref(I+"expiration");}catch(H){return F;}cookiedate=new Date(J);nowdate=new Date();if(cookiedate<nowdate){A(G);return F;}return K;}var D=B(C);E=q.surroundUserCallbackWithTryCatch(E,m);if(typeof E==="function"){E(D);}else{return D;}};var v=function(H){var E=u+e+".";var G={};try{var F=t.getBranch(E);var B=F.getChildList("",{});B.forEach(function(J){var K=J.indexOf(".expiration");if(K>-1){var I=J.substr(0,K);if(w.indexOf(e)<0||(w.indexOf(e)>=0&&l.indexOf(I)<0)){var L=n(y(I));if(L!==null){G[I]=L;}}}});}catch(D){}var C=JSON.stringify(G);H=q.surroundUserCallbackWithTryCatch(H,m);if(typeof H==="function"){H(C);}else{return C;}};var p=function(I){var D=u+e+".";var H=[];var L="";var E=t.getBranch(D).getChildList("",{});for(var G=0,K=E.length;G<K;++G){L=E[G];if(L.indexOf(".expiration")>=0){var B=L.substring(0,L.indexOf(".expiration"));if(w.indexOf(e)<0||(w.indexOf(e)>=0&&l.indexOf(B)<0)){var F=y(B);var C=n(F);if(C!==null){var J=t.getCharPref(D+B+".expiration");J=new Date(J).getTime();H.push({key:B,value:C,expiration:J});}}}}H=JSON.stringify(H);I=q.surroundUserCallbackWithTryCatch(I,m);if(typeof I==="function"){I(H);}else{return H;}};var i=function(I){var C=u+e+".";var G=[];var E=t.getBranch(C).getChildList("",{});var H="";for(var D=0,F=E.length;D<F;++D){H=E[D];if(H.indexOf(".expiration")>=0){var B=H.substring(0,H.indexOf(".expiration"));if(w.indexOf(e)<0||(w.indexOf(e)>=0&&l.indexOf(B)<0)){G.push(B);}}}G=JSON.stringify(G);if(typeof I==="function"){I=q.surroundUserCallbackWithTryCatch(I,m);I(G);}else{return G;}};var j=function(C,E){var D=null;if(typeof(C)==="string"||typeof(C)==="number"){if(y(C)!==null){var B=u+e+"."+C+".expiration";D=(new Date(t.getCharPref(B))).getTime();}}E=q.surroundUserCallbackWithTryCatch(E,m);if(typeof E==="function"){E(D);}else{return D;}};var o=function(E,D,G){var B=u+e+"."+E+".expiration";var C=t.prefHasUserValue(B);var F=false;if(C){t.setCharPref(B,D.toString());F=true;}G=q.surroundUserCallbackWithTryCatch(G,m);if(typeof G==="function"){G(F);}else{return F;}};var g=function(I){var C=u+e+".";var F=t.getBranch(C).getChildList("",{});var B="";var H="";var G=true;for(var D=0,E=F.length;D<E;++D){if(F[D].indexOf(".expiration")>=0){B=F[D];H=t.getCharPref(C+B);H=new Date(H).getTime();if(H<(new Date()).getTime()){B=B.substring(0,B.indexOf(".expiration"));A(B);}}}I=q.surroundUserCallbackWithTryCatch(I,m);if(typeof I==="function"){I(G);}else{return G;}};var A=function(E,F){var D=u+e+"."+E+".";var C=t.prefHasUserValue(D+"value");var B=false;if(C){t.deleteBranch(D);B=true;}F=q.surroundUserCallbackWithTryCatch(F,m);if(typeof F==="function"){F(B);}else{return B;}};var k=function(G){var C=true;if(w.indexOf(e)>=0){try{var B=t.getChildList(u+e+".",{});var E;for(var D=0;D<B.length;D++){E=B[D].replace(u+e+".","");E=E.substr(0,E.indexOf("."));if(l.indexOf(E)<0){t.deleteBranch(B[D]);}}}catch(F){}}else{t.deleteBranch(u+e+".");}G=q.surroundUserCallbackWithTryCatch(G,m);if(typeof G==="function"){G(C);}else{return C;}};function z(B,C){return function(E){var D=function(H,I){if(B&&(typeof B=="function")){B(H,I);}};var F=function(H,I){if(C&&(typeof C=="function")){C(H,I);}};var G=JSON.stringify(E.additionalInfo);if(E.call==="success"){D(E.response,G);}else{F(E.response,G);}};}var h=function(E,B,J,G,D){try{G=q.surroundUserCallbackWithTryCatch(G,m);var C=function(L){var K=escape(JSON.stringify(L));r(B,K,J);if(typeof G==="function"){G(L);}};D=q.surroundUserCallbackWithTryCatch(D,m);D=typeof D!=="function"?function(){}:D;var H=z(C,D);var I=new MyEXT60804.XHR({url:E,method:"GET",async:true,callback:H});I.send();}catch(F){H({call:"failure",response:"Failed To Make Request: "+E});}};var f=function(){return{set:"wr",get:"wr",list:"wr",getList:"wr",getExpiration:"wr",getKeys:"wr",updateExpiration:"wr",removeExpired:"wr",remove:"wr",removeAll:"wr",setFromRemote:"wr",onDBReady:"wr"};};var s=function(B){B();return;};return{set:r,get:y,list:v,getList:p,getExpiration:j,getKeys:i,updateExpiration:o,removeExpired:g,remove:A,removeAll:k,setFromRemote:h,onDBReady:s,__exposedProps__:f()};};if(false&&MyEXT60804.AsyncDB.isSupported&&MyEXT60804.Utils.getFirefoxVersion()!=12){return a();}else{return c();}};
